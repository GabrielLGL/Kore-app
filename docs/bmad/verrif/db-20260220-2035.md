# Cohérence WatermelonDB — 20260220-2035

## Résultat : ✅ Cohérent (1 avertissement mineur)

Schéma v16 · 8 tables · 8 modèles

---

### Couverture tables ↔ modèles

| Table | Modèle | Statut |
|-------|--------|--------|
| `programs` | `Program.ts` | ✅ |
| `sessions` | `Session.ts` | ✅ |
| `session_exercises` | `SessionExercise.ts` | ✅ |
| `exercises` | `Exercise.ts` | ✅ |
| `performance_logs` | `PerformanceLog.ts` | ✅ |
| `users` | `User.ts` | ✅ |
| `histories` | `History.ts` | ✅ |
| `sets` | `Set.ts` | ✅ |

Tous les modèles sont enregistrés dans `model/index.ts` → `modelClasses` ✅

---

### Incohérences schéma ↔ modèles

Aucune incohérence critique.

| Table | Problème |
|-------|----------|
| — | — |

---

### Avertissements mineurs (non bloquants)

| Table | Colonne | Problème |
|-------|---------|----------|
| `sessions` | `position` | Schéma `isOptional: true` (peut être null) mais modèle déclare `position!: number` (non-null assertion). `Program` gère correctement avec `position?: number`. |
| `exercises` | `muscles` | Schéma `isOptional: true` mais modèle déclare `_muscles!: string`. Géré à runtime par le getter (`\|\| '[]'`), pas bloquant. |

---

### Vérification colonnes par table

**programs** — 4 colonnes
| Colonne schéma | Décorateur modèle | Type | OK |
|---|---|---|---|
| `name` (string) | `@field('name') name!: string` | ✅ | ✅ |
| `position` (number, optional) | `@field('position') position?: number` | ✅ | ✅ |
| `created_at` (number) | `@readonly @date('created_at')` | ✅ | ✅ |
| `updated_at` (number) | `@readonly @date('updated_at')` | ✅ | ✅ |

**sessions** — 6 colonnes
| Colonne schéma | Décorateur modèle | Type | OK |
|---|---|---|---|
| `program_id` (string) | `@relation('programs', 'program_id')` | ✅ | ✅ |
| `name` (string) | `@field('name') name!: string` | ✅ | ✅ |
| `position` (number, optional) | `@field('position') position!: number` | ⚠️ `!` vs optional | ⚠️ |
| `created_at` (number) | `@readonly @date('created_at')` | ✅ | ✅ |
| `updated_at` (number) | `@readonly @date('updated_at')` | ✅ | ✅ |
| `deleted_at` (number, optional) | `@date('deleted_at') deletedAt!: Date \| null` | ✅ | ✅ |

**session_exercises** — 7 colonnes
| Colonne schéma | Décorateur modèle | OK |
|---|---|---|
| `session_id` (string) | `@relation('sessions', 'session_id')` | ✅ |
| `exercise_id` (string) | `@relation('exercises', 'exercise_id')` | ✅ |
| `position` (number) | `@field('position') position!: number` | ✅ |
| `sets_target` (number, optional) | `@field('sets_target') setsTarget?: number` | ✅ |
| `reps_target` (string, optional) | `@field('reps_target') repsTarget?: string` | ✅ |
| `weight_target` (number, optional) | `@field('weight_target') weightTarget?: number` | ✅ |
| `created_at` / `updated_at` | `@readonly @date(...)` | ✅ |

**exercises** — 6 colonnes
| Colonne schéma | Décorateur modèle | OK |
|---|---|---|
| `name` (string) | `@text('name') name!: string` | ✅ |
| `is_custom` (boolean) | `@field('is_custom') isCustom!: boolean` | ✅ |
| `muscles` (string, optional) | `@text('muscles') _muscles!: string` | ⚠️ voir note |
| `equipment` (string, optional) | `@text('equipment') equipment?: string` | ✅ |
| `created_at` / `updated_at` | `@readonly @date(...)` | ✅ |

**performance_logs** — 5 colonnes (pas d'`updated_at` — cohérent)
| Colonne schéma | Décorateur modèle | OK |
|---|---|---|
| `exercise_id` (string) | `@relation('exercises', 'exercise_id')` | ✅ |
| `sets` (number) | `@field('sets') sets!: number` | ✅ |
| `weight` (number) | `@field('weight') weight!: number` | ✅ |
| `reps` (number) | `@field('reps') reps!: number` | ✅ |
| `created_at` (number) | `@readonly @date('created_at')` | ✅ |

**users** — 8 colonnes (v16 avec ai_provider + ai_api_key)
| Colonne schéma | Décorateur modèle | OK |
|---|---|---|
| `email` (string) | `@text('email') email!: string` | ✅ |
| `timer_enabled` (boolean) | `@field('timer_enabled') timerEnabled!: boolean` | ✅ |
| `rest_duration` (number) | `@field('rest_duration') restDuration!: number` | ✅ |
| `onboarding_completed` (boolean) | `@field('onboarding_completed') onboardingCompleted!: boolean` | ✅ |
| `ai_provider` (string, optional) | `@text('ai_provider') aiProvider!: string \| null` | ✅ |
| `ai_api_key` (string, optional) | `@text('ai_api_key') aiApiKey!: string \| null` | ✅ |
| `created_at` / `updated_at` | `@readonly @date(...)` | ✅ |

**histories** — 7 colonnes
| Colonne schéma | Décorateur modèle | OK |
|---|---|---|
| `session_id` (string) | `@relation('sessions', 'session_id')` | ✅ |
| `start_time` (number) | `@date('start_time') startTime!: Date` | ✅ |
| `end_time` (number, optional) | `@date('end_time') endTime?: Date` | ✅ |
| `note` (string, optional) | `@text('note') note?: string` | ✅ |
| `created_at` / `updated_at` | `@readonly @date(...)` | ✅ |
| `deleted_at` (number, optional) | `@date('deleted_at') deletedAt!: Date \| null` | ✅ |

**sets** — 8 colonnes
| Colonne schéma | Décorateur modèle | OK |
|---|---|---|
| `history_id` (string) | `@relation('histories', 'history_id')` | ✅ |
| `exercise_id` (string) | `@relation('exercises', 'exercise_id')` | ✅ |
| `weight` (number) | `@field('weight') weight!: number` | ✅ |
| `reps` (number) | `@field('reps') reps!: number` | ✅ |
| `set_order` (number) | `@field('set_order') setOrder!: number` | ✅ |
| `is_pr` (boolean) | `@field('is_pr') isPr!: boolean` | ✅ |
| `created_at` / `updated_at` | `@readonly @date(...)` | ✅ |

---

### Relations

| Modèle | Relation | Table cible | Clé | Statut |
|--------|----------|-------------|-----|--------|
| Program | `@children('sessions')` | sessions | `program_id` | ✅ |
| Session | `@relation('programs', ...)` | programs | `program_id` | ✅ |
| Session | `@children('histories')` | histories | `session_id` | ✅ |
| Session | `@children('session_exercises')` | session_exercises | `session_id` | ✅ |
| SessionExercise | `@relation('sessions', ...)` | sessions | `session_id` | ✅ |
| SessionExercise | `@relation('exercises', ...)` | exercises | `exercise_id` | ✅ |
| Exercise | `has_many session_exercises` | session_exercises | `exercise_id` | ✅ |
| Exercise | `has_many performance_logs` | performance_logs | `exercise_id` | ✅ |
| Exercise | `has_many sets` | sets | `exercise_id` | ✅ |
| PerformanceLog | `@relation('exercises', ...)` | exercises | `exercise_id` | ✅ |
| History | `@relation('sessions', ...)` | sessions | `session_id` | ✅ |
| History | `@children('sets')` | sets | `history_id` | ✅ |
| Set | `@relation('histories', ...)` | histories | `history_id` | ✅ |
| Set | `@relation('exercises', ...)` | exercises | `exercise_id` | ✅ |

Aucune relation orpheline. Toutes les tables cibles existent.

---

### Migrations

**Aucun fichier de migrations détecté.** L'adaptateur SQLite est configuré sans `migrations` → la base est **recréée** à chaque changement de version de schéma.

> ℹ️ Info (non bloquant pour le développement). En production, un fichier `migrations.ts` sera nécessaire pour préserver les données utilisateur lors des mises à jour.

---

## Résumé

| Critère | Résultat |
|---------|----------|
| Tables sans modèle | 0 |
| Modèles sans table | 0 |
| Colonnes schéma sans décorateur | 0 |
| Décorateurs sans colonne schéma | 0 |
| Relations orphelines | 0 |
| Migrations | Absentes (info) |
| Avertissements TypeScript mineurs | 2 (non bloquants) |
