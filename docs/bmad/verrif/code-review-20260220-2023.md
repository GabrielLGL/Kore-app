# Code Review ‚Äî 20260220-2023

## R√©sultat : 8 probl√®mes trouv√©s

---

### üî¥ Critiques

| # | Fichier | Ligne | Probl√®me | Impact |
|---|---------|-------|----------|--------|
| 1 | `hooks/useProgramManager.ts` | 85, 104, 124, 159, 208, 227, 253 | `console.error(...)` sans guard `__DEV__` (7 instances) | Fuite de stack traces en production ‚Äî violation CLAUDE.md ¬ß3.1 |
| 2 | `hooks/useSessionManager.ts` | 108, 148, 170, 213 | `console.error(...)` sans guard `__DEV__` (4 instances) | Idem ‚Äî incoh√©rent avec `useExerciseManager` qui garde correctement |
| 3 | `components/WorkoutExerciseCard.tsx` | 249, 321 | Couleurs hardcod√©es : `rgba(52,199,89,0.12)` (vert) et `rgba(0,122,255,0.15)` (bleu) | Violation CLAUDE.md ¬ß3.1 "No hardcoded colors" |
| 4 | `components/RestTimer.tsx` | 177 | Couleur hardcod√©e : `rgba(255,255,255,0.08)` | Violation CLAUDE.md ¬ß3.1 "No hardcoded colors" |

### üü° Warnings

| # | Fichier | Ligne | Probl√®me | Impact |
|---|---------|-------|----------|--------|
| 5 | `screens/ExercisesScreen.tsx` | 180 | `renderItem` inline (arrow function) sans `useCallback` + `ItemSeparatorComponent` inline | Nouvelle r√©f√©rence √† chaque render ‚Üí re-render inutile de toute la FlatList |
| 6 | `screens/WorkoutScreen.tsx` | 178 | `renderItem` inline sans `useCallback` | Idem ‚Äî critique car appel√© fr√©quemment pendant l'entra√Ænement |
| 7 | `screens/SettingsScreen.tsx` | 87, 91, 99, 110 | `Alert.alert()` natif (√ó4) | Incoh√©rence UI : le reste de l'app utilise `<AlertDialog>` / `<BottomSheet>` via Portal |
| 8 | `screens/AssistantScreen.tsx` | 241, 379 | `Alert.alert()` natif (√ó2) pour les erreurs de g√©n√©ration IA | Idem ‚Äî feedback d'erreur non uniforme |

### üîµ Suggestions

| # | Fichier | Ligne | Probl√®me | Suggestion |
|---|---------|-------|----------|------------|
| 9 | `screens/ExercisesScreen.tsx` | 241, 269 | Logique toggle dupliqu√©e : `prev.includes(m) ? prev.filter(x => x !== m) : [...prev, m]` ‚Äî m√™me pattern dans `AssistantScreen.tsx` (lignes 277, 289) | Extraire `toggleArrayItem<T>(arr: T[], item: T): T[]` dans `databaseHelpers.ts` ou un nouveau `arrayUtils.ts` |
| 10 | `screens/AssistantScreen.tsx` | 385‚Äì539 | Fonction `renderStepContent()` de 154 lignes avec nesting profond | D√©composer en composants par √©tape (`WizardStep1`, `WizardStep2`, etc.) |

---

## D√©tail des probl√®mes confirm√©s

### Probl√®me #1 & #2 ‚Äî console.error sans __DEV__ (11 instances)

```ts
// useProgramManager.ts ‚Äî AVANT (x7)
} catch (error) {
  console.error('Failed to save program:', error)  // ‚Üê leak en prod

// APR√àS
} catch (error) {
  if (__DEV__) console.error('[useProgramManager] Failed to save program:', error)
```

Contraste : `useExerciseManager.ts:79` est d√©j√† correct ‚Äî `if (__DEV__) console.error(...)`.

### Probl√®me #3 & #4 ‚Äî Couleurs hardcod√©es

```ts
// WorkoutExerciseCard.tsx:249 ‚Äî AVANT
backgroundColor: 'rgba(52, 199, 89, 0.12)',  // vert iOS
// WorkoutExerciseCard.tsx:321 ‚Äî AVANT
backgroundColor: 'rgba(0,122,255,0.15)',      // bleu iOS
// RestTimer.tsx:177 ‚Äî AVANT
backgroundColor: 'rgba(255,255,255,0.08)',    // blanc semi-transparent
```

Ces valeurs doivent rejoindre `theme/index.ts` : `colors.successSurface`, `colors.primarySurface`, `colors.surfaceOverlay`.

### Probl√®me #5 & #6 ‚Äî renderItem inline

```tsx
// ExercisesScreen.tsx:180 ‚Äî AVANT
renderItem={({ item }) => (   // ‚Üê nouvelle ref √† chaque render
  <View style={styles.exoItem}>...

// APR√àS
const renderExerciseItem = useCallback(({ item }: { item: Exercise }) => (
  <View style={styles.exoItem}>...
), [])
```

`WorkoutScreen.tsx:178` ‚Äî m√™me correction. `HomeScreen.tsx` est d√©j√† correct (utilise `useCallback`).

### Probl√®me #7 & #8 ‚Äî Alert.alert() natif

```ts
// SettingsScreen.tsx:87 ‚Äî AVANT
Alert.alert('Mode Offline', 'Aucune connexion √† tester en mode offline.')
// AssistantScreen.tsx:241 ‚Äî AVANT
Alert.alert('Erreur', 'Impossible de g√©n√©rer le plan. R√©essaie.')
```

√Ä remplacer par des toasts/snackbar, ou √† int√©grer dans la UI de l'√©cran (message d'erreur inline). `Alert` natif est une API bloquante qui casse l'exp√©rience sur Android.

---

## Parall√©lisation des corrections

| # | Probl√®me | Fichiers | Effort | Groupe |
|---|----------|----------|--------|--------|
| 1-2 | console.error sans __DEV__ | `useProgramManager.ts`, `useSessionManager.ts` | ~5 min | **A** |
| 3-4 | Couleurs hardcod√©es | `WorkoutExerciseCard.tsx`, `RestTimer.tsx`, `theme/index.ts` | ~10 min | **B** |
| 5-6 | renderItem sans useCallback | `ExercisesScreen.tsx`, `WorkoutScreen.tsx` | ~5 min | **C** |
| 7-8 | Alert.alert() natif | `SettingsScreen.tsx`, `AssistantScreen.tsx` | ~15 min | **D** |
| 9 | Toggle logic dupliqu√© | `ExercisesScreen.tsx`, `AssistantScreen.tsx` | ~10 min | **E** |
| 10 | renderStepContent 154L | `AssistantScreen.tsx` | ~20 min | **D** (m√™me fichier) |

- Claude Code 1 : Groupes **A** + **C** (fichiers diff√©rents, sans d√©pendances)
- Claude Code 2 : Groupes **B** (theme + 2 composants)
- Claude Code 3 : Groupes **D** + **E** (AssistantScreen + SettingsScreen)
