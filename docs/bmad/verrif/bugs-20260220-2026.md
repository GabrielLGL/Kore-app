# Bugs silencieux â€” 20260220-2026

## RÃ©sumÃ© : ğŸ”´ 1 critique / ğŸŸ¡ 5 warnings

### Critiques

| Fichier | Ligne | Type | Description |
|---------|-------|------|-------------|
| `mobile/src/model/utils/databaseHelpers.ts` | ~314 | Null Safety | `getLastPerformanceForExercise()` â€” accÃ¨s Ã  `mostRecent.id` sans null check. `histories.sort()[0]` retourne `undefined` sur un tableau vide â†’ crash runtime |

### Warnings

| Fichier | Ligne | Type | Description |
|---------|-------|------|-------------|
| `mobile/src/model/utils/databaseHelpers.ts` | ~304-311 | Null Safety | `Promise.all()` sur `find()` peut retourner des `null` dans le tableau â€” le `.sort()` suivant assume des objets `History` valides |
| `mobile/src/model/utils/databaseHelpers.ts` | ~316-323 | Division | Guard `recentSets.length === 0` avant division â€” structure fragile mais fonctionnelle |
| `mobile/src/components/WorkoutSummarySheet.tsx` | ~58-67 | Promise | Appels `updateHistoryNote()` dans debounce non awaited â€” erreurs silencieusement ignorÃ©es en production |
| `mobile/src/components/RestTimer.tsx` | ~38 | Promise | `scheduleRestEndNotification().catch()` â€” log uniquement en `__DEV__`, erreur silencieuse en production |
| `mobile/src/services/sentry.ts` | ~21-70 | Code Quality | `console.log`/`console.warn` prÃ©sents â€” gardÃ©s par `__DEV__` mais pourraient utiliser Sentry logging Ã  la place |

### âœ… Points conformes

- Toutes les mutations WatermelonDB (`.create`, `.update`, `.destroyPermanently`, `.batch`) sont dans des `database.write()`
- Tous les `setTimeout`/`setInterval` ont un `clearTimeout`/`clearInterval` dans les cleanups `useEffect`
- Tous les `addEventListener` ont un `removeEventListener` correspondant
- Les observables `withObservables` sont correctement gÃ©rÃ©s par le framework
- Aucun `async` sans `try/catch` ou gestion d'erreur
- Aucune couleur hardcodÃ©e (utilisation correcte de `colors.*`)
- Aucun `any` TypeScript

---

## ParallÃ©lisation des corrections

| # | ProblÃ¨me | Fichiers | Effort | Groupe |
|---|----------|----------|--------|--------|
| 1 | Null check `mostRecent` aprÃ¨s sort()[0] | `databaseHelpers.ts` | ~5 min | A |
| 2 | Null check rÃ©sultats `Promise.all()` + `find()` | `databaseHelpers.ts` | ~10 min | A |
| 3 | Gestion erreur promise `WorkoutSummarySheet` debounce | `WorkoutSummarySheet.tsx` | ~5 min | B |
| 4 | Gestion erreur promise `RestTimer` notification | `RestTimer.tsx` | ~5 min | C |

- **Claude Code 1 â€” Groupe A** : `databaseHelpers.ts` (null safety, 2 corrections sÃ©quentielles)
- **Claude Code 2 â€” Groupe B** : `WorkoutSummarySheet.tsx` (promise debounce)
- **Claude Code 3 â€” Groupe C** : `RestTimer.tsx` (promise notification)

> Groupes B et C peuvent tourner en parallÃ¨le avec A.
