<!-- v1.0 — 2026-02-22 -->
# Rapport — Stats UX — Groupe E — 20260222-1430

## Objectif
Corriger 2 problèmes dans l'écran Mesures corporelles :
1. Le champ "Taille" prête à confusion — en français "Taille" peut signifier la taille (hauteur) ou le tour de taille. Renommer en "Tour de taille" pour clarifier que c'est le tour de taille en cm.
2. Le haut de la BottomSheet d'ajout est masqué par le clavier — revoir l'UX pour que le formulaire soit entièrement visible/scrollable quand le clavier est ouvert.

## Fichiers concernés
- `mobile/src/screens/StatsMeasurementsScreen.tsx`

## Contexte technique

### Problème 1 — Label "Taille"
- Dans le tableau `METRICS`, le label est `'Taille'` avec unit `'cm'`
- C'est censé être le tour de taille (waist circumference) mais l'utilisateur peut penser à la taille (height)
- Il faut renommer le label en `'Tour de taille'`
- L'historique affiche `T:${m.waist}cm` — garder le préfixe `T:` ou changer en `TdT:` pour cohérence

### Problème 2 — BottomSheet + clavier
- La BottomSheet (`components/BottomSheet.tsx`) utilise `justifyContent: 'flex-end'` et s'affiche en bas
- Le formulaire contient 5 TextInput + 2 boutons, soit ~400-500px de hauteur
- Quand le clavier s'ouvre (~300px sur Android), il masque le bas du formulaire
- Le `KeyboardAvoidingView` actuel (ligne 257) ne fonctionne pas bien car :
  - Sur Android `behavior={undefined}` → pas d'ajustement
  - Il est INSIDE la BottomSheet, donc le padding/height n'a pas d'effet sur le positionnement
- **Solution recommandée** : Envelopper le contenu du formulaire dans une `ScrollView` avec `keyboardShouldPersistTaps="handled"`, et ajouter un `paddingBottom` suffisant pour compenser le clavier. Sur Android, le `windowSoftInputMode` dans le manifest est probablement `adjustResize`, donc la ScrollView devrait fonctionner naturellement.
- **Alternative** : Déplacer le `KeyboardAvoidingView` pour qu'il englobe la BottomSheet entière (mais attention au pattern Portal)

### Structure actuelle de la BottomSheet
```tsx
<BottomSheet visible={addSheet.isOpen} onClose={addSheet.close} title="Nouvelle mesure">
  <KeyboardAvoidingView behavior={Platform.OS === 'ios' ? 'padding' : undefined}>
    <View style={styles.formContent}>
      {METRICS.map(m => (
        <View key={m.key} style={styles.inputRow}>
          <Text>{m.label} ({m.unit})</Text>
          <TextInput ... />
        </View>
      ))}
      <View style={styles.formButtons}>...</View>
    </View>
  </KeyboardAvoidingView>
</BottomSheet>
```

### BottomSheet component
- Le composant `BottomSheet` est dans `components/BottomSheet.tsx`
- Son contenu est positionné avec `justifyContent: 'flex-end'`
- Il a un `paddingBottom: spacing.xxl` et `paddingHorizontal: spacing.lg`
- Le contenu ne scroll pas actuellement — c'est une View statique

## Etapes
1. Lire `StatsMeasurementsScreen.tsx` pour comprendre la structure complète
2. **Renommer "Taille" en "Tour de taille"** :
   - Dans `METRICS`, changer `{ key: 'waist', label: 'Taille', unit: 'cm' }` en `{ key: 'waist', label: 'Tour de taille', unit: 'cm' }`
   - Dans l'historique (ligne 223), le préfixe `T:` reste OK car c'est une abréviation dans une liste compacte
3. **Corriger le problème de clavier dans la BottomSheet** :
   - Remplacer le `KeyboardAvoidingView` + `View` par une `ScrollView` :
     ```tsx
     <BottomSheet visible={addSheet.isOpen} onClose={addSheet.close} title="Nouvelle mesure">
       <ScrollView
         keyboardShouldPersistTaps="handled"
         showsVerticalScrollIndicator={false}
         style={{ maxHeight: screenHeight * 0.6 }}
       >
         <View style={styles.formContent}>
           {/* inputs et boutons */}
         </View>
       </ScrollView>
     </BottomSheet>
     ```
   - Ajouter `import { Dimensions } from 'react-native'` si pas déjà importé (ou utiliser `useWindowDimensions`)
   - La `maxHeight` limite la hauteur de la BottomSheet pour laisser de la place au titre et au drag handle
   - La `ScrollView` permet de scroller le formulaire quand le clavier est ouvert
   - Supprimer le `KeyboardAvoidingView` devenu inutile
   - Supprimer l'import de `KeyboardAvoidingView` et `Platform` s'ils ne sont plus utilisés
4. Vérifier `npx tsc --noEmit`

## Contraintes
- Ne PAS modifier `components/BottomSheet.tsx` — modifier uniquement le contenu passé en children
- Ne pas changer la clé `waist` dans la DB ni le model `BodyMeasurement`
- Garder le préfixe `T:` dans l'historique compact (c'est une abréviation lisible)
- Utiliser les couleurs du thème uniquement

## Criteres de validation
- `npx tsc --noEmit` -> zero erreur
- Le label "Tour de taille" est affiché dans le formulaire et les dernières mesures
- La BottomSheet de saisie est entièrement visible/scrollable quand le clavier est ouvert
- Le formulaire peut être complètement scrollé pour atteindre les boutons du bas
- Les inputs restent fonctionnels avec le clavier ouvert

## Dependances
Aucune dépendance

## Statut
En attente
