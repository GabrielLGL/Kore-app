<!-- v1.0 — 2026-02-23 -->
# Rapport — Coverage Tests Vague 2 — Groupe A — 20260223-2200

## Objectif
Augmenter la couverture des 5 écrans ayant le plus faible taux de coverage (< 50% statements). Ce sont les fichiers avec le plus gros impact potentiel sur le score global.

## Fichiers concernés
1. `mobile/src/screens/ChartsScreen.tsx` — 25% stmts
2. `mobile/src/screens/ProgramsScreen.tsx` — 29% stmts
3. `mobile/src/screens/AssistantScreen.tsx` — 33% stmts
4. `mobile/src/screens/SessionDetailScreen.tsx` — 42% stmts
5. `mobile/src/screens/StatsMeasurementsScreen.tsx` — 45% stmts

Tests existants à enrichir :
- `mobile/src/screens/__tests__/ChartsScreen.test.tsx`
- `mobile/src/screens/__tests__/ProgramsScreen.test.tsx`
- `mobile/src/screens/__tests__/AssistantScreen.test.tsx`
- `mobile/src/screens/__tests__/SessionDetailScreen.test.tsx`
- `mobile/src/screens/__tests__/StatsMeasurementsScreen.test.tsx`

## Contexte technique
- **Stack** : React Native (Expo 52) + TypeScript + WatermelonDB
- **Pattern de test** : Jest + React Native Testing Library
- **Mocks WatermelonDB** : Les tests existants mockent `@nozbe/watermelondb`, `@nozbe/watermelondb/react`, et `@nozbe/with-observables`. Suivre le pattern des tests existants.
- **Navigation** : Mocker `@react-navigation/native` avec `useNavigation` et `useRoute`
- **Langage app** : Français (les textes des boutons et labels sont en français)
- **Theme** : Dark mode (#121212 bg), tous les styles viennent de `theme/index.ts`

## Étapes

### 1. Lire chaque fichier source et son test existant
Pour chaque écran, identifier :
- Les branches non couvertes (lignes listées dans le coverage report)
- Les fonctions non testées
- Les interactions utilisateur manquantes

### 2. ChartsScreen.tsx (25% → cible 65%+)
Lignes non couvertes : 50-165, 177, 243-244, 278-279, 349
- Tester le rendu avec données mockées (exercices, historique)
- Tester les sélections de filtres (exercice, période)
- Tester le calcul et affichage des graphiques
- Tester le cas "aucune donnée"

### 3. ProgramsScreen.tsx (29% → cible 65%+)
Lignes non couvertes : 91-107, 126-127, 132-196, 210-220, 246-416, 505
- Tester la création d'un programme
- Tester la suppression (avec AlertDialog)
- Tester la duplication d'un programme
- Tester le réordonnancement (drag & drop)
- Tester la navigation vers SessionDetail
- Tester les menus contextuels (BottomSheet)

### 4. AssistantScreen.tsx (33% → cible 55%+)
Lignes non couvertes : 142, 166-167, 240-434, 444-547, 564-579, 601, 696-719
- Tester le rendu initial (champs de formulaire)
- Tester la soumission du formulaire
- Tester les différents états (loading, error, success)
- Tester la sélection du provider AI
- Mocker le service AI (ne PAS appeler de vraie API)

### 5. SessionDetailScreen.tsx (42% → cible 65%+)
Lignes non couvertes : 71-97, 112-130, 168-183, 220-224
- Tester l'ajout d'un exercice à la session
- Tester la suppression d'un exercice
- Tester la modification des targets (sets, reps, weight)
- Tester le réordonnancement
- Tester la navigation retour

### 6. StatsMeasurementsScreen.tsx (45% → cible 70%+)
Lignes non couvertes : 86-92, 100-130, 146, 175-190, 226, 264-289
- Tester l'ajout d'une mesure corporelle
- Tester l'affichage du graphique avec données
- Tester les différents onglets (poids, tour de taille, etc.)
- Tester le cas sans données

### 7. Vérifier
```bash
cd mobile && npx jest --coverage --collectCoverageFrom='src/screens/ChartsScreen.tsx' --collectCoverageFrom='src/screens/ProgramsScreen.tsx' --collectCoverageFrom='src/screens/AssistantScreen.tsx' --collectCoverageFrom='src/screens/SessionDetailScreen.tsx' --collectCoverageFrom='src/screens/StatsMeasurementsScreen.tsx' src/screens/__tests__/ChartsScreen.test.tsx src/screens/__tests__/ProgramsScreen.test.tsx src/screens/__tests__/AssistantScreen.test.tsx src/screens/__tests__/SessionDetailScreen.test.tsx src/screens/__tests__/StatsMeasurementsScreen.test.tsx
```

## Contraintes
- Ne pas casser les 935 tests existants
- Ne pas modifier les fichiers source — uniquement les fichiers de test
- Suivre les patterns de mock existants (lire les tests voisins comme référence)
- Tous les textes UI sont en français
- Utiliser `fireEvent` et `waitFor` de `@testing-library/react-native`
- Ne pas utiliser `<Modal>` natif (Fabric crash) — les écrans utilisent Portal

## Critères de validation
- `npx tsc --noEmit` → zéro erreur
- `npm test` → zéro fail (935+ tests passent)
- Coverage de chaque écran augmentée d'au moins 20 points

## Dépendances
Aucune dépendance — ce groupe est indépendant des groupes B et C.

## Statut
⏳ En attente
