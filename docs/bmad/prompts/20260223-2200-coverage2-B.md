<!-- v1.0 — 2026-02-23 -->
# Rapport — Coverage Tests Vague 2 — Groupe B — 20260223-2200

## Objectif
Augmenter la couverture des 5 écrans ayant un coverage entre 50% et 68%. Second lot d'impact.

## Fichiers concernés
1. `mobile/src/screens/ExercisesScreen.tsx` — 52% stmts
2. `mobile/src/screens/WorkoutScreen.tsx` — 62% stmts
3. `mobile/src/screens/SettingsScreen.tsx` — 64% stmts
4. `mobile/src/screens/StatsCalendarScreen.tsx` — 66% stmts
5. `mobile/src/screens/StatsDurationScreen.tsx` — 68% stmts

Tests existants à enrichir :
- `mobile/src/screens/__tests__/ExercisesScreen.test.tsx`
- `mobile/src/screens/__tests__/WorkoutScreen.test.tsx`
- `mobile/src/screens/__tests__/SettingsScreen.test.tsx`
- `mobile/src/screens/__tests__/StatsCalendarScreen.test.tsx`
- `mobile/src/screens/__tests__/StatsDurationScreen.test.tsx`

## Contexte technique
- **Stack** : React Native (Expo 52) + TypeScript + WatermelonDB
- **Pattern de test** : Jest + React Native Testing Library
- **Mocks WatermelonDB** : Les tests existants mockent `@nozbe/watermelondb`, `@nozbe/watermelondb/react`, et `@nozbe/with-observables`. Suivre le pattern des tests existants.
- **Navigation** : Mocker `@react-navigation/native` avec `useNavigation` et `useRoute`
- **Langage app** : Français (les textes des boutons et labels sont en français)

## Étapes

### 1. Lire chaque fichier source et son test existant
Pour chaque écran, identifier les branches et fonctions non couvertes.

### 2. ExercisesScreen.tsx (52% → cible 75%+)
Lignes non couvertes : 20, 56-61, 70-74, 96-98, 103-106, 111-114, 127-129, 221-233, 254-259
- Tester la création d'un exercice custom
- Tester les filtres (muscle, équipement) avec ChipSelector
- Tester la recherche d'exercices
- Tester la suppression d'un exercice custom
- Tester la modification d'un exercice
- Tester le cas liste vide

### 3. WorkoutScreen.tsx (62% → cible 80%+)
Lignes non couvertes : 78-79, 102-103, 113, 119-124, 132-133, 149-153, 160-162, 206, 247-258, 316-322
- Tester l'ajout d'une série (set)
- Tester la validation des inputs (poids, reps)
- Tester le timer de repos
- Tester la fin de séance (résumé)
- Tester la navigation retour avec confirmation
- Tester le PR detection

### 4. SettingsScreen.tsx (64% → cible 80%+)
Lignes non couvertes : 39, 44, 49-58, 70, 75-76, 370-372
- Tester le toggle du timer
- Tester le changement de durée de repos
- Tester la configuration AI (provider, clé API)
- Tester le changement de nom utilisateur
- Tester l'onboarding reset

### 5. StatsCalendarScreen.tsx (66% → cible 80%+)
Lignes non couvertes : 32-33, 124-167, 198, 237
- Tester le changement de mois (navigation calendrier)
- Tester le tap sur un jour avec des entraînements
- Tester l'affichage des détails d'un entraînement sélectionné
- Tester le cas "aucun entraînement ce mois"

### 6. StatsDurationScreen.tsx (68% → cible 85%+)
Lignes non couvertes : 60-61, 69-76, 100-110
- Tester les différentes périodes (7j, 30j, 90j)
- Tester le calcul des durées moyennes
- Tester le cas "pas assez de données"

### 7. Vérifier
```bash
cd mobile && npx jest --coverage src/screens/__tests__/ExercisesScreen.test.tsx src/screens/__tests__/WorkoutScreen.test.tsx src/screens/__tests__/SettingsScreen.test.tsx src/screens/__tests__/StatsCalendarScreen.test.tsx src/screens/__tests__/StatsDurationScreen.test.tsx
```

## Contraintes
- Ne pas casser les 935 tests existants
- Ne pas modifier les fichiers source — uniquement les fichiers de test
- Suivre les patterns de mock existants (lire les tests voisins comme référence)
- Tous les textes UI sont en français
- Utiliser `fireEvent` et `waitFor` de `@testing-library/react-native`

## Critères de validation
- `npx tsc --noEmit` → zéro erreur
- `npm test` → zéro fail (935+ tests passent)
- Coverage de chaque écran augmentée d'au moins 15 points

## Dépendances
Aucune dépendance — ce groupe est indépendant des groupes A et C.

## Statut
⏳ En attente
